{"version":3,"file":"autocomplete-base.js","sourceRoot":"","sources":["../../../../src/ts/components/autocomplete-base.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n    AfterViewChecked,\n    AfterViewInit,\n    ElementRef,\n    EventEmitter,\n    OnChanges,\n    OnDestroy,\n    OnInit,\n    SimpleChanges,\n} from '@angular/core';\nimport { ControlValueAccessor } from '@angular/forms';\n\nexport abstract class AutocompleteBase\n    implements ControlValueAccessor, OnDestroy, OnChanges, AfterViewInit, AfterViewChecked, OnChanges, OnInit {\n    protected inputElement: HTMLInputElement;\n    protected onDocumentClick: () => any;\n    protected skipDocumentClick = false;\n    protected onChange: any = Function.prototype;\n    protected onTouched: any = Function.prototype;\n    protected changeInput: EventEmitter<string>;\n    protected valueGetter: (value: any) => string;\n    protected descriptionGetter: (value: any, highlightFunc: (str: string) => string) => string | HTMLElement;\n    protected highlight: boolean;\n    protected stripTags = true;\n    protected values: Array<any>;\n    protected dropdownOuterContainer: HTMLElement;\n    protected dropdownContainer: ElementRef;\n    protected onDocumentEvent: () => void;\n    protected showDropdownChange: EventEmitter<boolean>;\n    protected tempDiv = document.createElement('DIV');\n    protected decryptionCache: { [key: string]: string | HTMLElement } = {};\n\n    private _showDropdown = false;\n\n    public selectedText = '';\n    public disabled: boolean;\n    public cssClass: string;\n\n    public get showDropdown(): boolean {\n        return this._showDropdown;\n    }\n\n    public set showDropdown(value: boolean) {\n        this.setShowDropdown(value);\n    }\n\n    public constructor(protected element: ElementRef) {\n        this.dropdownOuterContainer = document.createElement('div');\n        this.dropdownOuterContainer.classList.add('deltix-autocomplete', 'autocomplete-outer-container');\n        document.body.appendChild(this.dropdownOuterContainer);\n        this.onDocumentEvent = () => {\n            this.updateDropdownPosition();\n        };\n        document.addEventListener('scroll', this.onDocumentEvent, true);\n        document.addEventListener('resize', this.onDocumentEvent, true);\n    }\n\n    protected setShowDropdown(value: boolean) {\n        if (this._showDropdown === value) {\n            return;\n        }\n        this._showDropdown = value;\n        if (this.showDropdownChange != null) {\n            this.showDropdownChange.emit(this._showDropdown);\n        }\n    }\n\n    protected onElementKeyUp(event: KeyboardEvent) {\n        if (event.keyCode === 40) { // down\n            const next = (<HTMLElement>event.target).parentElement.nextElementSibling;\n            if (next != null && next['tagName'] === 'LI') {\n                const a = <HTMLElement>next.firstElementChild;\n                a.focus();\n            }\n        } else if (event.keyCode === 38) { // up\n            const prev = (<HTMLElement>event.target).parentElement.previousElementSibling;\n            if (prev != null && prev['tagName'] === 'LI') {\n                const a = <HTMLElement>prev.firstElementChild;\n                a.focus();\n            } else {\n                this.inputElement.focus();\n            }\n        }\n    }\n\n    public onAutocompleteClick(event: any) {\n        this.skipDocumentClick = true;\n    }\n\n    public onInput(event: KeyboardEvent) {\n        const element = <HTMLInputElement>event.target;\n        this.inputEmit(element.value);\n    }\n\n    protected inputEmit(str: string) {\n        this.changeInput.emit(str);\n    }\n\n    public onFocus(event: Event) {\n        this.showDropdown = true;\n    }\n\n    protected toggleDropdown(event: Event) {\n        this.showDropdown = !this.showDropdown;\n        if (!this.showDropdown) {\n            this.decryptionCache = {};\n        }\n    }\n\n    protected highlightTitle(item: any): string | HTMLElement {\n        let description = this.getTitleForItem(item);\n        if (this.isTrue(this.stripTags)) {\n            description = this.stripTagsFromString(description instanceof HTMLElement ? description.innerHTML : description);\n            if (this.isTrue(this.highlight)) {\n                return this.highlightText(description, this.selectedText);\n            }\n        }\n        return description;\n    }\n\n    protected escapeRegExp(str: string): string {\n        return str.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&');\n    }\n\n    protected highlightText(text: string, highlightStr: string): string {\n        if (!highlightStr) {\n            return text;\n        }\n        const regexp = new RegExp(`(${this.escapeRegExp(highlightStr)})`, 'im');\n        return text.replace(regexp, '<span>$1</span>');\n    }\n\n    protected getValueForItem(item: any, separator?: string, literal?: string): string {\n        if (typeof this.valueGetter === 'function') {\n            return this.valueGetter.call(null, item);\n        }\n        if (item == null) {\n            return '';\n        }\n        if (typeof item === 'string') {\n            if (item.includes(separator)) {\n                return `${literal}${item}${literal}`;\n            }\n            return item;\n        }\n        if (typeof item === 'number') {\n            return item + '';\n        }\n\n        return '[object]';\n    }\n\n    protected getTitleForItem(item: any): string | HTMLElement {\n        const value = this.getValueForItem(item);\n        if (this.decryptionCache.hasOwnProperty(value)) {\n            return this.decryptionCache[value];\n        }\n        if (item != null && typeof this.descriptionGetter === 'function') {\n            return this.decryptionCache[value] =\n                this.descriptionGetter.call(null, item, (str: string) => this.highlightText(str, this.selectedText));\n        }\n\n        return value;\n    }\n\n    protected stripTagsFromString(str: string) {\n        const tmp = this.tempDiv;\n        tmp.innerHTML = str;\n        return tmp.textContent || tmp.innerText || '';\n    }\n\n    protected initInputElement() {\n        if (this.inputElement == null) {\n            this.inputElement = this.element.nativeElement.querySelector('input');\n        }\n    }\n\n    protected onDocumentClickCallback() {\n        // empty method\n    }\n\n    protected isFalse(value: boolean | string): boolean {\n        if (typeof value === 'string') {\n            return value === 'false';\n        }\n        return !value;\n    }\n\n    protected isTrue(value: boolean | string): boolean {\n        if (typeof value === 'string') {\n            return value === 'true';\n        }\n        return value;\n    }\n\n    protected isShowDropdown(): boolean {\n        return this.showDropdown && this.values.length > 0;\n    }\n\n    protected updateDropdownPosition() {\n        const div: HTMLElement = this.element.nativeElement;\n        const rect = div.getBoundingClientRect();\n        const dropdown: HTMLElement = this.dropdownContainer.nativeElement;\n\n        const dropdownRect = dropdown.getBoundingClientRect();\n        const offset = rect.top + rect.height;\n\n        let fullHeight = false;\n        if (window.innerHeight < offset + dropdownRect.height || offset < 0) {\n            if (rect.top - dropdownRect.height < 0) {\n                dropdown.style.top = '0px';\n                if (dropdownRect.height >= window.innerHeight) {\n                    fullHeight = true;\n                    dropdown.style.maxHeight = dropdownRect.height + 'px';\n                }\n            } else {\n                dropdown.style.top = (rect.top - dropdownRect.height) + 'px';\n            }\n        } else {\n            dropdown.style.top = offset + 'px';\n        }\n        dropdown.style.width = rect.width + 'px';\n        dropdown.style.left = rect.left + 'px';\n\n        if (fullHeight) {\n            dropdown.classList.add('autocomplete-full-height');\n        } else {\n            dropdown.classList.remove('autocomplete-full-height');\n        }\n    }\n\n    public ngOnInit(): void {\n        document.addEventListener('click', this.onDocumentClick = () => {\n            if (!this.skipDocumentClick) {\n                this.showDropdown = false;\n            }\n            this.skipDocumentClick = false;\n            this.onDocumentClickCallback.call(this);\n        });\n    }\n\n    public ngOnChanges(changes: SimpleChanges): void {\n        this.initInputElement();\n        if (changes['dropdown'] != null) {\n            if (this.isFalse(changes['dropdown'].currentValue)) {\n                this.inputElement.removeAttribute('readonly');\n            } else {\n                this.inputElement.setAttribute('readonly', '');\n            }\n        } else if (changes['values'] != null) {\n            this.decryptionCache = {};\n        }\n    }\n\n    public ngAfterViewInit() {\n        this.dropdownOuterContainer.appendChild(this.dropdownContainer.nativeElement);\n        if (this.cssClass != null) {\n            this.dropdownOuterContainer.classList.add(this.cssClass);\n        }\n    }\n\n    public ngAfterViewChecked() {\n        if (this.disabled || !this.showDropdown) {\n            return;\n        }\n        this.updateDropdownPosition();\n    }\n\n    public registerOnChange(fn: any): void {\n        this.onChange = fn;\n    }\n\n    public registerOnTouched(fn: any): void {\n        this.onTouched = fn;\n    }\n\n    public setDisabledState(isDisabled: boolean): void {\n        this.disabled = isDisabled;\n    }\n\n    public ngOnDestroy(): void {\n        document.removeEventListener('click', this.onDocumentClick);\n        document.removeEventListener('scroll', this.onDocumentEvent);\n        document.removeEventListener('resize', this.onDocumentEvent);\n        this.dropdownOuterContainer.remove();\n    }\n\n    public isSelected(value: any): boolean {\n        return false;\n    }\n\n    public onKeyUp(event: KeyboardEvent) {\n        if (event.keyCode === 40) { // down\n            const el = <HTMLElement>this.dropdownContainer.nativeElement;\n            const items = el.querySelectorAll('.autocomplete-dropdown-item');\n            if (items.length > 0) {\n                const first: HTMLElement = <HTMLElement>items.item(0).firstElementChild;\n                first.focus();\n            }\n            return;\n        }\n    }\n\n    public onInputClick(event: Event) {\n        // empty\n    }\n\n    public getTitleAttrValueForItem(value: any): string {\n        const title = this.getTitleForItem(value);\n        return this.stripTagsFromString(title instanceof HTMLElement ? title.innerHTML : title);\n    }\n\n    public select(item: any, event: Event): void {\n        this.decryptionCache = {};\n    }\n\n    public abstract onBlur(event: Event): void;\n\n    public abstract writeValue(obj: any): void;\n}\n"]}